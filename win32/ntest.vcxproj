<?xml version="1.0" encoding="utf-8"?>
<Project	DefaultTargets="Build"
			InitialTargets="Check"
			ToolsVersion="15.0"
			xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<Import Project="targets\project-configurations.targets" />
	<PropertyGroup Label="Globals">
		<VCProjectVersion>15.0</VCProjectVersion>
		<ProjectGuid>{4EB1D61E-64E4-46B9-8120-6FB2A9848189}</ProjectGuid>
		<Keyword>ConsoleProject</Keyword>
		<RootNamespace>ntest</RootNamespace>
		<WindowsTargetPlatformVersion>10.0.17763.0</WindowsTargetPlatformVersion>
	</PropertyGroup>
	
  	<Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
	<Import Project="targets\console-configurations.targets" />
	<Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
	<ImportGroup Label="ExtensionSettings" />
	<ImportGroup Label="Shared" />
	<Import Project="targets\appdata-platform.targets" />

	<PropertyGroup Label="UserMacros">
		<Home>$(MSBuildProjectDirectory)\..</Home>
		<OpenSSLFolder Condition="'$(OpenSSLFolder)'==''">$(Home)\dist\$(Platform)\ssl</OpenSSLFolder>
		<LibidnFolder Condition="'$(LibidnFolder)'==''">$(Home)\dist\$(Platform)\idn</LibidnFolder>
		<CompileDir Condition="'$(CompileDir)'==''">$(Home)\bin</CompileDir>
		<BuildDir Condition="'$(BuildDir)'==''">$(Home)\dist</BuildDir>
		<NharuLib Condition="'$(NharuLib)'==''">$(Home)\dist\$(Platform)\$(Configuration)\nharu</NharuLib>
		<IntDir>$(CompileDir)\$(Platform)\$(Configuration)\$(ProjectName)\</IntDir>
		<OutDir>$(BuildDir)\$(Platform)\$(Configuration)\$(ProjectName)\</OutDir>
		<IncludeFolders>
			$(Home);
			$(Home)\include;
			$(OpenSSLFolder)\include;
			$(LibidnFolder)\include;
			$(VCInstallDir)\Tools\MSVC\14.16.27023\ATLMFC\include;
			$(VCInstallDir)\Tools\MSVC\14.16.27023\include;
			$(WindowsSdkDir)\include\10.0.17763.0\ucrt;
			$(WindowsSdkDir)\include\10.0.17763.0\shared;
			$(WindowsSdkDir)\include\10.0.17763.0\um;
			$(WindowsSdkDir)\include\10.0.17763.0\winrt;
			$(WindowsSdkDir)\include\10.0.17763.0\cppwinrt
		</IncludeFolders>
		<Warnings>4018;4389;4244;4005;4142;4701;4703;4706</Warnings>
		<Dependencies>
			nharu.lib;libidn.lib;libcrypto.lib;
			crypt32.lib;ws2_32.lib;kernel32.lib;user32.lib;gdi32.lib;winspool.lib;odbc32.lib;
			comdlg32.lib;advapi32.lib;shell32.lib;ole32.lib;oleaut32.lib;uuid.lib;odbccp32.lib
		</Dependencies>
		<TargetSubSystem>Console</TargetSubSystem>
		<Libraries>$(NharuLib);$(OpenSSLFolder)\lib;$(LibidnFolder)\lib</Libraries>
		<IsDLL>false</IsDLL>
	</PropertyGroup>

	<Import Project="targets\console-vars.targets" />
	<Import Project="targets\debug.targets" Condition="'$(Configuration)'=='Debug'" />
	<Import Project="targets\release.targets" Condition="'$(Configuration)'=='Release'" />

	<ItemGroup>
		<ClInclude Include="$(Home)\test\test.h" />
	</ItemGroup>
	<ItemGroup>
		<ClCompile Include="$(Home)\test\cadest.c" />
		<ClCompile Include="$(Home)\test\cert_t.c" />
		<ClCompile Include="$(Home)\test\cms_t.c" />
		<ClCompile Include="$(Home)\test\crl_t.c" />
		<ClCompile Include="$(Home)\test\crypto_t.c" />
		<ClCompile Include="$(Home)\test\issue_t.c" />
		<ClCompile Include="$(Home)\test\nmain.c" />
		<ClCompile Include="$(Home)\test\parser_t.c" />
	</ItemGroup>

	<Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
	<ImportGroup Label="ExtensionTargets" />
	<Import Project="targets\common.targets" />

	<Target Name="Test" DependsOnTargets="Config">
		<Error Text="Test application must be built first" Condition="!Exists('$(OutDir)$(ProjectName)$(TargetExt)')" />
		<Exec Command='"$(OutDir)$(ProjectName)$(TargetExt)" "$(Home)\test\repo"' EchoOff="true" />
	</Target>

	<Target Name="Check" >
		<Message Text="Checking prerequisites" />
		<Error Text="Static library must be found at $(NharuLib)\nharu.lib" Condition="!Exists('$(NharuLib)\nharu.lib')" />
		<Error Text="OpenSSL library $(OpenSSLFolder)\lib\libcrypto.lib must be built first" Condition="!Exists('$(OpenSSLFolder)\lib\libcrypto.lib')" />
		<Error Text="GNU Libidn library must be built first" Condition="!Exists('$(LibidnFolder)\lib\libidn.lib')" />
	</Target>

</Project>