<?xml version="1.0" encoding="utf-8"?>
<Project	DefaultTargets="Build"
			InitialTargets="Check"
			ToolsVersion="15.0"
			xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<Import Project="targets\project-configurations.targets" />
	<PropertyGroup Label="Globals">
		<VCProjectVersion>15.0</VCProjectVersion>
		<ProjectGuid>{0A4CDDBD-50BB-4EAD-A02A-002BBD9CAF44}</ProjectGuid>
		<Keyword>DynamicLibraryProject</Keyword>
		<RootNamespace>nharujca</RootNamespace>
		<WindowsTargetPlatformVersion>10.0.17763.0</WindowsTargetPlatformVersion>
	</PropertyGroup>

  	<Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
	<Import Project="targets\sharedlib-configurations.targets" />
	<Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
	<ImportGroup Label="ExtensionSettings" />
	<ImportGroup Label="Shared" />
	<Import Project="targets\appdata-platform.targets" />

	<PropertyGroup Label="UserMacros">
		<Home>$(MSBuildProjectDirectory)\..</Home>
		<NharuLib Condition="'$(NharuLib)'==''">$(Home)\dist\$(Platform)\$(Configuration)\nharu</NharuLib>
		<OpenSSLFolder Condition="'$(OpenSSLFolder)'==''">$(Home)\dist\ssl</OpenSSLFolder>
		<LibidnFolder Condition="'$(LibidnFolder)'==''">$(Home)\dist\idn</LibidnFolder>
		<JDKHome Condition="'$(JDKHome)'==''">$(JAVA_HOME)</JDKHome>
		<CompileDir Condition="'$(CompileDir)'==''">$(Home)\bin</CompileDir>
		<BuildDir Condition="'$(BuildDir)'==''">$(Home)\dist</BuildDir>
		<IntDir>$(CompileDir)\$(Platform)\$(Configuration)\$(ProjectName)\</IntDir>
		<OutDir>$(BuildDir)\$(Platform)\$(Configuration)\$(ProjectName)\</OutDir>
		<Prefix>$(BuildDir)\$(Platform)\$(ProjectName)</Prefix>
		<IncludeFolders>
			$(Home);
			$(Home)\include;
			$(Home)\jca\native;
			$(JDKHome)\include;
			$(JDKHome)\include\win32;
			$(OpenSSLFolder)\include;
			$(LibidnFolder)\include;
			$(VCInstallDir)\Tools\MSVC\14.16.27023\ATLMFC\include;
			$(VCInstallDir)\Tools\MSVC\14.16.27023\include;
			$(WindowsSdkDir)\include\10.0.17763.0\ucrt;
			$(WindowsSdkDir)\include\10.0.17763.0\shared;
			$(WindowsSdkDir)\include\10.0.17763.0\um;
			$(WindowsSdkDir)\include\10.0.17763.0\winrt;
			$(WindowsSdkDir)\include\10.0.17763.0\cppwinrt
		</IncludeFolders>
		<Warnings>4018;4389;4244;4005;4142;4701;4703;4706</Warnings>
		<Dependencies>
			nharu.lib;libidn.lib;libcrypto.lib;
			crypt32.lib;ws2_32.lib;kernel32.lib;user32.lib;gdi32.lib;winspool.lib;odbc32.lib;
			comdlg32.lib;advapi32.lib;shell32.lib;ole32.lib;oleaut32.lib;uuid.lib;odbccp32.lib
		</Dependencies>
		<TargetSubSystem>Windows</TargetSubSystem>
		<Libraries>$(NharuLib);$(OpenSSLFolder)\lib;$(LibidnFolder)\lib</Libraries>
		<IsDLL>true</IsDLL>
	</PropertyGroup>

	<Import Project="targets\sharedlib-vars.targets" />
	<Import Project="targets\debug.targets" Condition="'$(Configuration)'=='Debug'" />
	<Import Project="targets\release.targets" Condition="'$(Configuration)'=='Release'" />

	<ItemGroup>
		<ClInclude Include="$(Home)\jca\native\jca.h" />
		<ClInclude Include="$(Home)\jca\native\jcms.h" />
		<ClInclude Include="$(Home)\jca\native\jcrypto.h" />
		<ClInclude Include="$(Home)\jca\native\jissue.h" />
		<ClInclude Include="$(Home)\jca\native\version.h" />
		<ClInclude Include="$(Home)\jca\native\x509.h" />
		<ClInclude Include="$(Home)\jca\native\b64\cdecode.h" />
		<ClInclude Include="$(Home)\jca\native\b64\cencode.h" />
		<ClInclude Include="$(Home)\jca\native\sb8\crc.h" />
	</ItemGroup>
	<ItemGroup>
		<ClCompile Include="$(Home)\jca\native\8x256_tables.c" />
		<ClCompile Include="$(Home)\jca\native\cdecode.c" />
		<ClCompile Include="$(Home)\jca\native\cencode.c" />
		<ClCompile Include="$(Home)\jca\native\cms_glue.c" />
		<ClCompile Include="$(Home)\jca\native\crc.c" />
		<ClCompile Include="$(Home)\jca\native\crypto_glue.c" />
		<ClCompile Include="$(Home)\jca\native\general.c" />
		<ClCompile Include="$(Home)\jca\native\issue_glue.c" />
		<ClCompile Include="$(Home)\jca\native\version.c" />
		<ClCompile Include="$(Home)\jca\native\versionjca.c" />
		<ClCompile Include="$(Home)\jca\native\x509_glue.c" />
	</ItemGroup>

	<Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
	<ImportGroup Label="ExtensionTargets" />

	<Target Name="GetVersion" BeforeTargets="MakeVersion">
		<Exec Command="git describe" ConsoleToMsBuild="true" EchoOff="true">
			<Output TaskParameter="ConsoleOutput" PropertyName="GitVersion" />
		</Exec>
	</Target>
	<Target Name="MakeVersion" BeforeTargets="ClCompile">
		<Exec Command="$(Home)\jca\make_version.bat $(GitVersion)" EchoOff="true" />
	</Target>

	<Target Name="Install">
		<Error Text="Dinamic library must be built first" Condition="!Exists('$(OutDir)$(ProjectName)$(TargetExt)')" />
		<Copy SourceFiles="$(OutDir)$(ProjectName)$(TargetExt)" DestinationFolder="$(Prefix)\libs" />
	</Target>

	<Target Name="Check">
		<Message Text="Checking prerequisites" />
		<Error Text="Static library must be found at $(NharuLib)\nharu.lib" Condition="!Exists('$(NharuLib)\nharu.lib')" />
		<Error Text="OpenSSL library must be built first" Condition="!Exists('$(OpenSSLFolder)\lib\libcrypto.lib')" />
		<Error Text="GNU Libidn library must be built first" Condition="!Exists('$(LibidnFolder)\lib\libidn.lib')" />
	</Target>

</Project>
