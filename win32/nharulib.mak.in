# configure.bat replacements
ANT_CONTRIB = _ANT_CONTRIB_
PACKAGE     = _PACKAGE_
OUTPUT      = _PREFIX_
ANT_HOME    = _ANT_HOME_
JRE_7       = _JRE_7_

# Local definitions
ANT_CMDLINE = -DJAVA_LOG_PATH=org.crypthing.security -DANT_CONTRIB_LIB=$(ANT_CONTRIB) -DBUILD_DEST=$(OUTPUT) -DJRE_7=$(JRE_7)

# Compile target
build:
	$(MAKE) /F $(PACKAGE)\src\nharu.mak
	^!$(PACKAGE)\jca\make_version $(PACKAGE)\jca\native $(VERSION)
	$(MAKE) /F $(PACKAGE)\jca\native\nharujca.mak
	^!$(ANT_HOME)\bin\ant -buildfile $(PACKAGE)\jca\build.xml $(ANT_CMDLINE) -DVERSION=$(VERSION)

# Installation target
install:
	$(MAKE) /F $(PACKAGE)\src\nharu.mak install
	$(MAKE) /F $(PACKAGE)\jca\native\nharujca.mak install
	^!$(ANT_HOME)\bin\ant -buildfile $(PACKAGE)\jca\build.xml $(ANT_CMDLINE) install

# Clean-up
clean:
	$(MAKE) /F $(PACKAGE)\src\nharu.mak clean
	$(MAKE) /F $(PACKAGE)\jca\native\nharujca.mak clean
	^!$(ANT_HOME)\bin\ant -buildfile $(PACKAGE)\jca\build.xml $(ANT_CMDLINE) clean

# Installation clean-up
distclean:
	$(MAKE) /F $(PACKAGE)\src\nharu.mak distclean
	$(MAKE) /F $(PACKAGE)\jca\native\nharujca.mak distclean
	^!$(ANT_HOME)\bin\ant -buildfile $(PACKAGE)\jca\build.xml $(ANT_CMDLINE) clean

# Provider test
test-provider:
	^!java -cp $(PACKAGE)\jca\nharujca.jar org.crypthing.security.provider.NharuProvider $(PACKAGE)\test\signer.p12
