ANT_CONTRIB=_ANT_CONTRIB_
PACKAGE=_PACKAGE_
OUTPUT=_PREFIX_
LIBIDN=_LIBIDN_
ANT_HOME=_ANT_HOME_

^!IFNDEF VERSION
^!ERROR Required a macro VERSION definition
^!ENDIF
^!IFNDEF NODEBUG
ANT_CMDLINE = -DJAVA_LOG_PATH=org.crypthing.security -DANT_CONTRIB_LIB=$(ANT_CONTRIB) -DDEBUG=1
^!ELSE
ANT_CMDLINE = -DJAVA_LOG_PATH=org.crypthing.security -DANT_CONTRIB_LIB=$(ANT_CONTRIB)
^!ENDIF

all:
	$(MAKE) /F $(PACKAGE)\src\nharu.mak
	$(MAKE) /F $(PACKAGE)\src\nharu.mak install
	^!$(ANT_HOME)\bin\ant -buildfile $(PACKAGE)\jca\build.xml $(ANT_CMDLINE)
	^!$(PACKAGE)\jca\make_version $(VERSION) $(PACKAGE)\jca\native
	$(MAKE) /F $(PACKAGE)\jca\native\nharujca.mak
	$(MAKE) /F $(PACKAGE)\jca\native\nharujca.mak install
	^!$(ANT_HOME)\bin\ant -buildfile $(PACKAGE)\crl-service\build.xml $(ANT_CMDLINE) -DJEE_LIB=_JEE_LIB_ -DPICKETBOX=_PICKETBOX_

clean:
	$(MAKE) /F $(PACKAGE)\src\nharu.mak clean
	^!$(ANT_HOME)\bin\ant -buildfile $(PACKAGE)\jca\build.xml clean $(ANT_CMDLINE)
	$(MAKE) /F $(PACKAGE)\jca\native\nharujca.mak clean

test-provider:
	^!SET PATH=$(LIBIDN)\lib;$(PATH)
	^!java -cp $(OUTPUT);$(OUTPUT)\nharujca.jar org.crypthing.security.provider.NharuProvider $(PACKAGE)\test\signer.p12
	^!rm -f nharujca.dll