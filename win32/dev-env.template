@ECHO OFF

:: ---------------------------------------------------
:: Generated by configure.vbs - EDIT AT YOUR OWN RISK!
:: ---------------------------------------------------

ECHO.
ECHO  * * * * * * * * * * * * * * * * * * * * * * * *
ECHO  Nharu Library
ECHO  Environment for Windows Development
ECHO  -----------------------------------------------
ECHO  Copyleft (C) 2015 by The Crypthing Initiative
ECHO  Authors:
ECHO    diego.sohsten@caixa.gov.br
ECHO    yorick.flannagan@gmail.com
ECHO.
ECHO  * * * * * * * * * * * * * * * * * * * * * * * *
ECHO.

:: Set by configure.vbs
SET _JAVA_HOME=__JAVA_HOME__
SET _VS_INSTALL_PATH=__VS_INSTALL_PATH__
SET _ADD_PATH=__ADD_PATH__

:: Required paths
SET _CUR=%CD%
FOR %%i IN ("%~dp0..") DO SET "_HOME=%%~fi"
SET _PREFIX=%_HOME%\dist
SET _VERSION=1.3.0
SET _BUILD=0

:: Check arguments
FOR %%a IN (%*) DO (
    CALL:GET_ARGS "--","%%a" 
)
VERIFY >NUL
IF DEFINED --prefix (
	SET _PREFIX=%--prefix%
)
IF DEFINED --version (
	SET _VERSION=%--version%
)
IF DEFINED --add-path (
	SET _ADD_PATH=%--add-path%
)
IF DEFINED --build (
	SET _BUILD=1
)

:: MS NMAKE environment
CALL "%_VS_INSTALL_PATH%\VC\Auxiliary\Build\vcvarsamd64_x86.bat"
IF "%_ADD_PATH%" NEQ "" (
	SET "PATH=%PATH%;%_ADD_PATH%"
)

:: Nharu environment
SET HOME=%_HOME%
SET PREFIX=%_PREFIX%
SET JAVA_HOME=%_JAVA_HOME%
SET VERSION=%_VERSION%

:: Build (if required)
IF %_BUILD% EQU 1 (
	CD %_HOME%\win32
	NMAKE /F Makefile.mak
	IF %ERRORLEVEL% EQU 0 (
		NMAKE /F Makefile.mak TEST
		IF %ERRORLEVEL% EQU 0 (
			NMAKE /F Makefile.mak INSTALL
			IF %ERRORLEVEL% EQU 0 (
				NMAKE /F Makefile.mak CLEAN
			)
		)
	)
	CD %_CUR%
)
GOTO:END


:GET_ARGS
:: PROCESS COMAND LINE ARGUMENT OF TYPE --arg=value
:: %~1: ARGUMENT MARKER (USUALY --)
:: %~2: OUT
ECHO.%~2 | FINDSTR /C:"%~1" 1>nul
IF NOT ERRORLEVEL 1 (
	SET __KEY=%~2
) ELSE (
	SET __VALUE=%~2
)
IF DEFINED __KEY (
	SET %__KEY%=%~2
)
IF DEFINED __VALUE (
	IF DEFINED __KEY (
		SET %__KEY%=%~2
	)
	SET __KEY=
	SET __VALUE=
)
GOTO:EOF

:: Clean-up
:END
SET _PREFIX=
SET _VERSION=
SET _ADD_PATH=
SET _BUILD=
SET _HOME=
SET _JAVA_HOME=
SET _VS_INSTALL_PATH=
SET __KEY=
SET __VALUE=
SET _CUR=